---
title: 'P3812 【模板】线性基'
date: 2025-09-11T07:29
authors: lailai
tags: [solution, luogu]
---

## 原题链接

- [洛谷 P3812 【模板】线性基](https://www.luogu.com.cn/problem/P3812)

<!-- truncate -->

## 参考资料

- [线性基 - OI Wiki](https://oi-wiki.org/math/linear-algebra/basis/)
- [Basis (linear algebra) - Wikipedia](https://en.wikipedia.org/wiki/Basis_%28linear_algebra%29)
- [Zassenhaus algorithm - Wikipedia](https://en.wikipedia.org/wiki/Zassenhaus_algorithm)

## 题意简述

给定 $n$ 个整数（数字可能重复），求在这些数中选取任意个，使得他们的异或和最大。

## 解题思路

### 思想

把每个整数看作 $\mathbb{Z}_2^k$ 中的一个 $k$ 维向量。

在 $\mathbb{Z}_2$ 上，加法 $+$ 就是异或 $\operatorname{xor}$。于是问题等价为：给定 $n$ 个向量，选取任意个相加，使得结果尽可能大（按位比较）。

在线性代数里，这组向量张成一个线性空间。我们构造其 **线性基**（一组两两线性无关、能生成全空间的最小集合），再利用它在高位优先的结构，贪心得到最大异或值。

### 构造

维护数列 $p_i$ 表示最高位在第 $i$ 位为 $1$ 的基向量（若无则为 $0$）。

考虑插入整数 $x$，从高位到低位扫，若 $(x \gg i) \& 1 = 1$：

- 若 $p_i=0$，说明还没有，把 $x$ 放到 $p_i$，退出循环；
- 否则，令 $x\gets x\operatorname{xor} p_i$，把第 $i$ 位消到 $0$，继续向更低位消元。

若最终 $x=0$，说明它可由已有基向量异或得到（线性相关），无需加入基向量。

### 查询

令 $s=0$，从高位到低位，尝试用基向量 **增大** 答案：

$$
s\gets \max(s,s\operatorname{xor} p_i)
$$

### 正确性

数列 $p$ 始终是原集合张成空间的一组基：

- 所有非零 $p_i$ 的主元位互不相同，形成阶梯形结构。
- 任一已处理元素均可由当前 $p$ 表示（要么成为新主元，要么被消到 $0$）。

高位到低位的顺序保证：

- 处理到第 $i$ 位时，更高位已最优且不可再变；
- 若可把第 $i$ 位从 $0$ 翻到 $1$（存在合适的 $p_i$），则一定更优；
- 翻位后不影响更高位，低位仍可继续自由调整。  

因此贪心得到全局最优。

## 参考代码

```cpp
#include <bits/stdc++.h>
using namespace std;

using ull=unsigned long long;
const int N=64;
ull p[N];
void insert(ull x)
{
	for(int i=N-1;i>=0;i--)
	{
		if(x>>i&1)
		{
			if(!p[i])
			{
				p[i]=x;
				return;
			}
			x^=p[i];
		}
	}
}
ull query()
{
	ull res=0;
	for(int i=N-1;i>=0;i--)
	{
		res=max(res,res^p[i]);
	}
	return res;
}
int main()
{
	ios::sync_with_stdio(false);
	cin.tie(nullptr);
	int n;
	cin>>n;
	for(int i=1;i<=n;i++)
	{
		ull t;
		cin>>t;
		insert(t);
	}
	cout<<query()<<'\n';
	return 0;
}
```
